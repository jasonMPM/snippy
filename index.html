<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>to.ALWISP â€” URL Shortener</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #0a0a0f;
  --surface:  #111118;
  --surface2: #181824;
  --surface3: #1e1e2e;
  --border:   rgba(255,255,255,0.07);
  --accent:   #00e5a0;
  --accent2:  #ff5e62;
  --accent3:  #7c6af7;
  --text:     #e8e8f0;
  --muted:    #6b6b80;
  --radius:   12px;
  --font-head: 'Orbitron', sans-serif;
  --font-mono: 'Share Tech Mono', monospace;
  --font-body: 'Barlow', sans-serif;
}

html { scroll-behavior: smooth; }
body {
  background: var(--bg); color: var(--text);
  font-family: var(--font-body); font-size: 15px;
  line-height: 1.6; min-height: 100vh; overflow-x: hidden;
}

body::before {
  content: ''; position: fixed; inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 20% -10%, rgba(0,229,160,0.07) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 90% 80%, rgba(255,94,98,0.05) 0%, transparent 55%),
    radial-gradient(ellipse 40% 40% at 50% 50%, rgba(124,106,247,0.04) 0%, transparent 60%);
  pointer-events: none; z-index: 0;
}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header {
  position: sticky; top: 0; z-index: 100;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 40px; height: 64px;
  background: rgba(10,10,15,0.88);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}

.logo {
  font-family: var(--font-head); font-size: 18px; font-weight: 700;
  letter-spacing: 0.04em; text-decoration: none; color: var(--text);
}
.logo-dot-text { color: var(--accent); text-shadow: 0 0 12px var(--accent); }
.logo-alwisp   { text-transform: uppercase; }

nav { display: flex; gap: 4px; }
nav button {
  background: transparent; border: none; color: var(--muted);
  cursor: pointer; font-family: var(--font-body); font-size: 14px;
  padding: 6px 16px; border-radius: 8px; transition: all 0.2s;
}
nav button:hover  { color: var(--text); background: var(--surface2); }
nav button.active { color: var(--accent); background: rgba(0,229,160,0.08); }

/* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
main { position: relative; z-index: 1; }
.view { display: none; padding: 40px; max-width: 980px; margin: 0 auto; }
.view.active { display: block; animation: fadeIn 0.25s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

/* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero { text-align: center; padding: 60px 20px 40px; }
.hero h1 {
  font-family: var(--font-head);
  font-size: clamp(42px, 8vw, 88px);
  font-weight: 900; line-height: 1.0;
  letter-spacing: 0.06em; margin-bottom: 40px;
  text-transform: lowercase;
}
.hero-to    { color: var(--text); }
.hero-dot   { color: var(--accent); text-shadow: 0 0 20px var(--accent), 0 0 40px rgba(0,229,160,0.4); }
.hero-alwisp {
  text-transform: uppercase;
  background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}

/* â”€â”€ SHORTEN CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shorten-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 20px; padding: 32px; max-width: 720px; margin: 0 auto;
  box-shadow: 0 24px 64px rgba(0,0,0,0.4);
}

.input-group { display: flex; gap: 10px; margin-bottom: 20px; }
.input-group input {
  flex: 1; background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius); color: var(--text);
  font-family: var(--font-mono); font-size: 14px; padding: 14px 18px; outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.input-group input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,229,160,0.12); }
.input-group input::placeholder { color: var(--muted); }

.btn-primary {
  background: var(--accent); color: #000; border: none; cursor: pointer;
  font-family: var(--font-head); font-weight: 700; font-size: 13px;
  letter-spacing: 0.04em; padding: 14px 24px; border-radius: var(--radius);
  transition: all 0.2s; white-space: nowrap;
}
.btn-primary:hover  { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,229,160,0.35); }
.btn-primary:active { transform: none; }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

.advanced-toggle {
  color: var(--muted); font-size: 13px; cursor: pointer;
  display: flex; align-items: center; gap: 6px;
  margin-bottom: 16px; user-select: none; transition: color 0.2s; width: fit-content;
}
.advanced-toggle:hover { color: var(--text); }
.advanced-toggle svg { transition: transform 0.2s; }
.advanced-toggle.open svg { transform: rotate(90deg); }

.advanced-fields { display: none; gap: 12px; }
.advanced-fields.open { display: grid; grid-template-columns: 1fr 1fr; }

.field-label {
  font-size: 11px; font-family: var(--font-mono); letter-spacing: 0.08em;
  color: var(--muted); margin-bottom: 6px; display: block;
}
.field-input {
  width: 100%; background: var(--surface2); border: 1px solid var(--border);
  border-radius: 8px; color: var(--text); font-family: var(--font-mono);
  font-size: 13px; padding: 10px 14px; outline: none; transition: border-color 0.2s;
}
.field-input:focus { border-color: var(--accent); }
.field-input::placeholder { color: var(--muted); }

/* â”€â”€ TAG INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tag-input-wrap {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 8px; padding: 8px 12px;
  display: flex; flex-wrap: wrap; gap: 6px; align-items: center;
  transition: border-color 0.2s; cursor: text;
}
.tag-input-wrap:focus-within { border-color: var(--accent); }
.tag-pill {
  background: rgba(124,106,247,0.15); border: 1px solid rgba(124,106,247,0.3);
  color: #a89cf7; font-family: var(--font-mono); font-size: 11px;
  padding: 2px 8px; border-radius: 4px; display: flex; align-items: center; gap: 4px;
}
.tag-pill button {
  background: none; border: none; color: inherit; cursor: pointer;
  font-size: 13px; line-height: 1; padding: 0; opacity: 0.6;
}
.tag-pill button:hover { opacity: 1; }
.tag-input-inner {
  background: none; border: none; color: var(--text); font-family: var(--font-mono);
  font-size: 13px; outline: none; min-width: 80px; flex: 1;
}
.tag-input-inner::placeholder { color: var(--muted); }

/* â”€â”€ RESULT CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.result-card {
  background: linear-gradient(135deg, rgba(0,229,160,0.06), rgba(0,180,216,0.03));
  border: 1px solid rgba(0,229,160,0.2); border-radius: 16px; padding: 24px;
  margin-top: 20px; display: none;
  animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes slideIn { from { opacity: 0; transform: scale(0.96) translateY(8px); } to { opacity: 1; transform: none; } }
.result-card.visible { display: block; }
.result-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 20px; flex-wrap: wrap; }
.result-short-url {
  font-family: var(--font-mono); font-size: 22px; font-weight: 500;
  color: var(--accent); text-decoration: none; letter-spacing: -0.5px; word-break: break-all;
}
.result-short-url:hover { text-decoration: underline; }
.result-original { font-size: 12px; color: var(--muted); font-family: var(--font-mono); margin-top: 4px; word-break: break-all; }
.result-actions  { display: flex; gap: 8px; flex-shrink: 0; }
.result-qr {
  margin-top: 20px; display: flex; align-items: center; gap: 24px;
  padding-top: 20px; border-top: 1px solid var(--border); flex-wrap: wrap;
}
.qr-img-wrap { background: #fff; border-radius: 10px; padding: 10px; flex-shrink: 0; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
.qr-img-wrap img { display: block; width: 120px; height: 120px; }
.qr-info h4 { font-family: var(--font-head); font-size: 13px; margin-bottom: 6px; }
.qr-info p  { font-size: 12px; color: var(--muted); margin-bottom: 12px; }

/* â”€â”€ STATS STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-strip { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 32px; }
.stat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px; position: relative; overflow: hidden;
}
.stat-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, var(--accent), transparent);
}
.stat-value {
  font-family: var(--font-head); font-size: 30px; font-weight: 900;
  line-height: 1; margin-bottom: 4px;
  background: linear-gradient(135deg, var(--text), var(--muted));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.stat-label { font-size: 11px; color: var(--muted); font-family: var(--font-mono); letter-spacing: 0.06em; }

/* â”€â”€ TOOLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toolbar {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 20px; flex-wrap: wrap;
}
.search-wrap {
  flex: 1; min-width: 200px;
  position: relative;
}
.search-wrap svg {
  position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
  color: var(--muted); pointer-events: none;
}
.search-input {
  width: 100%; background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); color: var(--text); font-family: var(--font-mono);
  font-size: 13px; padding: 10px 14px 10px 38px; outline: none; transition: border-color 0.2s;
}
.search-input:focus { border-color: var(--accent); }
.search-input::placeholder { color: var(--muted); }

.tag-filter-list { display: flex; gap: 6px; flex-wrap: wrap; }
.tag-filter-btn {
  background: var(--surface); border: 1px solid var(--border);
  color: var(--muted); font-family: var(--font-mono); font-size: 11px;
  padding: 5px 12px; border-radius: 6px; cursor: pointer; transition: all 0.2s;
}
.tag-filter-btn:hover  { border-color: var(--accent3); color: #a89cf7; }
.tag-filter-btn.active { background: rgba(124,106,247,0.1); border-color: rgba(124,106,247,0.4); color: #a89cf7; }

/* â”€â”€ LINK ITEMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.links-list { display: flex; flex-direction: column; gap: 8px; }

.link-item {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); overflow: hidden; transition: border-color 0.2s;
}
.link-item:hover { border-color: rgba(0,229,160,0.15); }
.link-item.expanded { border-color: rgba(0,229,160,0.25); }

.link-row {
  padding: 16px 20px; display: flex; align-items: center;
  gap: 14px; cursor: pointer; user-select: none;
}
.link-code {
  font-family: var(--font-head); font-size: 15px; font-weight: 700;
  color: var(--accent); min-width: 80px; flex-shrink: 0;
}
.link-details { flex: 1; overflow: hidden; }
.link-title    { font-size: 13px; margin-bottom: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.link-original { font-family: var(--font-mono); font-size: 11px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.link-tags     { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 4px; }
.link-tag {
  background: rgba(124,106,247,0.1); border: 1px solid rgba(124,106,247,0.25);
  color: #a89cf7; font-family: var(--font-mono); font-size: 10px;
  padding: 1px 7px; border-radius: 3px;
}
.link-meta { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.link-clicks { font-family: var(--font-mono); font-size: 12px; color: var(--muted); white-space: nowrap; }
.link-clicks strong { color: var(--text); }
.link-chevron { color: var(--muted); transition: transform 0.25s; flex-shrink: 0; }
.link-item.expanded .link-chevron { transform: rotate(180deg); }

/* â”€â”€ EXPANDED PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.link-expanded {
  display: none; border-top: 1px solid var(--border);
  padding: 24px; background: var(--surface2);
  animation: expandIn 0.25s ease;
}
@keyframes expandIn { from { opacity: 0; } to { opacity: 1; } }
.link-item.expanded .link-expanded { display: block; }

.expanded-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }

.expanded-actions { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }

/* â”€â”€ EDIT FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.edit-form {
  background: var(--surface3); border: 1px solid var(--border);
  border-radius: 10px; padding: 20px; margin-bottom: 20px;
  display: none;
}
.edit-form.open { display: block; }
.edit-form h4 { font-family: var(--font-head); font-size: 12px; margin-bottom: 16px; color: var(--muted); letter-spacing: 0.06em; }
.edit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 14px; }
.edit-full { grid-column: 1 / -1; }
.edit-actions { display: flex; gap: 8px; justify-content: flex-end; }

/* â”€â”€ ANALYTICS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.analytics-wrap { }
.analytics-header {
  display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;
}
.analytics-title { font-family: var(--font-head); font-size: 12px; color: var(--muted); letter-spacing: 0.06em; }
.analytics-days  { display: flex; gap: 4px; }
.day-btn {
  background: var(--surface3); border: 1px solid var(--border);
  color: var(--muted); font-family: var(--font-mono); font-size: 11px;
  padding: 3px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s;
}
.day-btn:hover  { border-color: var(--accent); color: var(--accent); }
.day-btn.active { background: rgba(0,229,160,0.1); border-color: rgba(0,229,160,0.3); color: var(--accent); }

/* â”€â”€ MINI CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chart-wrap {
  background: var(--surface3); border: 1px solid var(--border);
  border-radius: 10px; padding: 16px; margin-bottom: 16px;
}
.chart-canvas { width: 100%; height: 100px; display: block; }

/* â”€â”€ BREAKDOWN GRIDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.breakdown-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
.breakdown-card {
  background: var(--surface3); border: 1px solid var(--border);
  border-radius: 10px; padding: 14px;
}
.breakdown-card h5 {
  font-family: var(--font-mono); font-size: 11px; color: var(--muted);
  letter-spacing: 0.08em; margin-bottom: 10px;
}
.breakdown-row {
  display: flex; align-items: center; gap: 8px; margin-bottom: 6px;
}
.breakdown-label { font-family: var(--font-mono); font-size: 12px; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.breakdown-bar-wrap { flex: 2; height: 4px; background: var(--surface2); border-radius: 2px; overflow: hidden; }
.breakdown-bar { height: 100%; border-radius: 2px; background: var(--accent); transition: width 0.4s ease; }
.breakdown-count { font-family: var(--font-mono); font-size: 11px; color: var(--muted); min-width: 28px; text-align: right; }

/* â”€â”€ SECTION HEAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.section-title { font-family: var(--font-head); font-size: 18px; font-weight: 700; }

/* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-sm {
  border: 1px solid var(--border); background: var(--surface2); color: var(--text);
  font-size: 11px; font-family: var(--font-mono); padding: 6px 14px;
  border-radius: 8px; cursor: pointer; transition: all 0.2s;
}
.btn-sm:hover { border-color: var(--accent); color: var(--accent); }
.btn-sm.danger:hover { border-color: var(--accent2); color: var(--accent2); }
.btn-sm.save { background: rgba(0,229,160,0.1); border-color: rgba(0,229,160,0.3); color: var(--accent); }
.btn-sm.save:hover { background: rgba(0,229,160,0.2); }

/* â”€â”€ QR VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.qr-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.panel { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; }
.panel h3 { font-family: var(--font-head); font-size: 14px; font-weight: 700; margin-bottom: 20px; }
.qr-preview-panel { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; min-height: 300px; }
.qr-preview-img   { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
.qr-preview-img img { display: block; width: 200px; height: 200px; }
.qr-placeholder {
  width: 200px; height: 200px; border: 2px dashed var(--border); border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  color: var(--muted); font-size: 12px; font-family: var(--font-mono); text-align: center; padding: 20px;
}
.color-row { display: flex; gap: 12px; margin-bottom: 16px; }
.color-field { flex: 1; }
.color-field label { font-size: 11px; color: var(--muted); font-family: var(--font-mono); display: block; margin-bottom: 6px; letter-spacing: 0.06em; }
.color-input-wrap { display: flex; align-items: center; gap: 8px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; }
input[type="color"]  { width: 24px; height: 24px; border: none; border-radius: 4px; padding: 0; cursor: pointer; background: none; flex-shrink: 0; }
.color-hex { font-family: var(--font-mono); font-size: 13px; background: none; border: none; color: var(--text); width: 70px; outline: none; }
input[type="range"]  { -webkit-appearance: none; width: 100%; height: 4px; background: var(--surface2); border-radius: 2px; outline: none; }
input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: var(--accent); border-radius: 50%; cursor: pointer; }

/* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast-container { position: fixed; bottom: 28px; right: 28px; display: flex; flex-direction: column; gap: 10px; z-index: 999; }
.toast {
  background: var(--surface2); border: 1px solid var(--border); border-radius: 10px;
  padding: 12px 18px; font-size: 13px; font-family: var(--font-mono);
  display: flex; align-items: center; gap: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  animation: toastIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes toastIn { from { opacity: 0; transform: translateX(20px) scale(0.95); } to { opacity: 1; transform: none; } }
.toast.success { border-color: rgba(0,229,160,0.3); }
.toast.error   { border-color: rgba(255,94,98,0.3); }

/* â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
.empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.3; }
.empty-state p { font-family: var(--font-mono); font-size: 13px; }

/* â”€â”€ SPINNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.spinner { width: 15px; height: 15px; border: 2px solid rgba(0,0,0,0.2); border-top-color: #000; border-radius: 50%; animation: spin 0.7s linear infinite; display: inline-block; }
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 700px) {
  header { padding: 0 20px; }
  .view  { padding: 20px 14px; }
  .stats-strip { grid-template-columns: 1fr 1fr; }
  .input-group { flex-direction: column; }
  .advanced-fields.open { grid-template-columns: 1fr; }
  .qr-grid { grid-template-columns: 1fr; }
  .breakdown-grid { grid-template-columns: 1fr; }
  .expanded-grid  { grid-template-columns: 1fr; }
  .edit-grid      { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<header>
  <a class="logo" href="/">
    <span class="logo-to">to</span><span class="logo-dot-text">.</span><span class="logo-alwisp">ALWISP</span>
  </a>
  <nav>
    <button class="active" data-view="home">Shorten</button>
    <button data-view="dashboard">Dashboard</button>
    <button data-view="qr">QR Codes</button>
  </nav>
</header>

<main>

<!-- â”€â”€ HOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="view active" id="view-home">
  <div class="hero">
    <h1><span class="hero-to">to</span><span class="hero-dot">.</span><span class="hero-alwisp">ALWISP</span></h1>
    <div class="shorten-card">
      <div class="input-group">
        <input type="url" id="url-input" placeholder="https://your-very-long-url.com/goes/right/here" autocomplete="off" spellcheck="false">
        <button class="btn-primary" id="shorten-btn"><span id="shorten-label">Snip it â†’</span></button>
      </div>

      <div class="advanced-toggle" id="adv-toggle">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M4.5 2L8.5 6L4.5 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        Advanced options
      </div>

      <div class="advanced-fields" id="adv-fields">
        <div>
          <label class="field-label">CUSTOM CODE</label>
          <input class="field-input" id="custom-code" placeholder="e.g. mylink" maxlength="20">
        </div>
        <div>
          <label class="field-label">TITLE (optional)</label>
          <input class="field-input" id="link-title" placeholder="e.g. My Homepage">
        </div>
        <div>
          <label class="field-label">EXPIRY DATE (optional)</label>
          <input class="field-input" type="date" id="link-expiry">
        </div>
        <div>
          <label class="field-label">TAGS (press Enter or comma)</label>
          <div class="tag-input-wrap" id="tag-input-wrap">
            <input class="tag-input-inner" id="tag-input" placeholder="e.g. marketing, social">
          </div>
        </div>
      </div>

      <div class="result-card" id="result-card">
        <div class="result-top">
          <div>
            <a class="result-short-url" id="result-url" href="#" target="_blank"></a>
            <div class="result-original" id="result-original"></div>
          </div>
          <div class="result-actions">
            <button class="btn-sm" id="copy-btn">Copy</button>
            <button class="btn-sm" id="dl-qr-btn">â†“ QR</button>
          </div>
        </div>
        <div class="result-qr">
          <div class="qr-img-wrap"><img id="result-qr-img" src="" alt="QR Code"></div>
          <div class="qr-info">
            <h4>QR Code Ready</h4>
            <p>Download or customize colors in the QR tab.</p>
            <button class="btn-sm" id="customize-qr-btn">Customize QR â†’</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="view" id="view-dashboard">
  <div class="stats-strip" id="stats-strip">
    <div class="stat-card">
      <div class="stat-value" id="stat-total">â€”</div>
      <div class="stat-label">TOTAL LINKS</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="stat-clicks">â€”</div>
      <div class="stat-label">TOTAL CLICKS</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="stat-7d">â€”</div>
      <div class="stat-label">CLICKS / 7 DAYS</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="stat-avg">â€”</div>
      <div class="stat-label">AVG CLICKS / LINK</div>
    </div>
  </div>

  <div class="toolbar">
    <div class="search-wrap">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
        <circle cx="6.5" cy="6.5" r="5.5" stroke="currentColor" stroke-width="1.5"/>
        <path d="M11 11L14.5 14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      <input class="search-input" id="search-input" placeholder="Search links, URLs, titles...">
    </div>
    <div class="tag-filter-list" id="tag-filter-list"></div>
    <button class="btn-sm" onclick="loadDashboard()">â†»</button>
  </div>

  <div class="links-list" id="links-list">
    <div class="empty-state"><div class="empty-icon">ğŸ”—</div><p>Loading...</p></div>
  </div>
</div>

<!-- â”€â”€ QR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="view" id="view-qr">
  <div class="section-head" style="margin-bottom:28px">
    <div>
      <div class="section-title">QR Generator</div>
      <div style="color:var(--muted);font-size:13px;margin-top:4px">Generate and customize QR codes for any URL</div>
    </div>
  </div>
  <div class="qr-grid">
    <div class="panel">
      <h3>Configure</h3>
      <label class="field-label">URL</label>
      <input class="field-input" id="qr-url-input" placeholder="https://example.com" style="margin-bottom:20px">
      <div class="color-row">
        <div class="color-field">
          <label>FOREGROUND</label>
          <div class="color-input-wrap">
            <input type="color" id="qr-fg-picker" value="#000000">
            <input class="color-hex" id="qr-fg-hex" value="000000" maxlength="6">
          </div>
        </div>
        <div class="color-field">
          <label>BACKGROUND</label>
          <div class="color-input-wrap">
            <input type="color" id="qr-bg-picker" value="#ffffff">
            <input class="color-hex" id="qr-bg-hex" value="ffffff" maxlength="6">
          </div>
        </div>
      </div>
      <div style="margin-bottom:20px">
        <label class="field-label">SIZE: <span id="qr-size-label">300px</span></label>
        <input type="range" id="qr-size" min="150" max="600" value="300" step="50">
      </div>
      <button class="btn-primary" id="qr-generate-btn" style="width:100%">Generate QR Code</button>
    </div>
    <div class="panel qr-preview-panel">
      <h3 style="align-self:flex-start;width:100%">Preview</h3>
      <div id="qr-preview-wrap">
        <div class="qr-placeholder">Enter a URL and click Generate</div>
      </div>
      <div id="qr-dl-row" style="display:none;flex-direction:column;align-items:center;gap:10px;width:100%">
        <a class="btn-primary" id="qr-download-link" download="qrcode.png" style="text-decoration:none;display:inline-block;text-align:center">â†“ Download PNG</a>
        <div style="font-size:12px;color:var(--muted);font-family:var(--font-mono)">Right-click to save</div>
      </div>
    </div>
  </div>
</div>

</main>

<div class="toast-container" id="toast-container"></div>

<script>
const BASE = window.location.origin;
let allTags = [];
let activeTag = null;
let searchTimer = null;
let tagInputTags = [];

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('nav button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(`view-${btn.dataset.view}`).classList.add('active');
    if (btn.dataset.view === 'dashboard') loadDashboard();
  });
});

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, type = 'success') {
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${type === 'success' ? 'âœ“' : 'âœ•'}</span><span>${msg}</span>`;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// â”€â”€ Advanced toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('adv-toggle').addEventListener('click', function() {
  this.classList.toggle('open');
  document.getElementById('adv-fields').classList.toggle('open');
});

// â”€â”€ Tag input (home form) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tagInput  = document.getElementById('tag-input');
const tagWrap   = document.getElementById('tag-input-wrap');

tagWrap.addEventListener('click', () => tagInput.focus());

tagInput.addEventListener('keydown', e => {
  if (e.key === 'Enter' || e.key === ',') {
    e.preventDefault();
    addTag(tagInput.value.trim().replace(/,$/, ''));
    tagInput.value = '';
  } else if (e.key === 'Backspace' && tagInput.value === '' && tagInputTags.length > 0) {
    removeTag(tagInputTags[tagInputTags.length - 1]);
  }
});

tagInput.addEventListener('blur', () => {
  if (tagInput.value.trim()) { addTag(tagInput.value.trim()); tagInput.value = ''; }
});

function addTag(name) {
  name = name.toLowerCase().replace(/[^a-z0-9-_]/g, '');
  if (!name || tagInputTags.includes(name)) return;
  tagInputTags.push(name);
  renderTagInputPills();
}

function removeTag(name) {
  tagInputTags = tagInputTags.filter(t => t !== name);
  renderTagInputPills();
}

function renderTagInputPills() {
  const existing = tagWrap.querySelectorAll('.tag-pill');
  existing.forEach(e => e.remove());
  tagInputTags.forEach(name => {
    const pill = document.createElement('div');
    pill.className = 'tag-pill';
    pill.innerHTML = `${name}<button onclick="removeTag('${name}')">Ã—</button>`;
    tagWrap.insertBefore(pill, tagInput);
  });
}

// â”€â”€ Shorten â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('shorten-btn').addEventListener('click', doShorten);
document.getElementById('url-input').addEventListener('keydown', e => { if (e.key === 'Enter') doShorten(); });

async function doShorten() {
  const url        = document.getElementById('url-input').value.trim();
  const customCode = document.getElementById('custom-code').value.trim();
  const title      = document.getElementById('link-title').value.trim();
  const expiry     = document.getElementById('link-expiry').value;

  if (!url) { toast('Please enter a URL', 'error'); return; }

  const btn = document.getElementById('shorten-btn');
  const lbl = document.getElementById('shorten-label');
  btn.disabled = true;
  lbl.innerHTML = '<span class="spinner"></span>';

  try {
    const resp = await fetch(`${BASE}/api/shorten`, {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url, custom_code: customCode, title, expires_at: expiry || null, tags: tagInputTags })
    });
    const data = await resp.json();
    if (!resp.ok) { toast(data.error || 'Something went wrong', 'error'); return; }
    showResult(data);
    toast('Link shortened!');
    tagInputTags = []; renderTagInputPills();
  } catch(e) {
    toast('Network error', 'error');
  } finally {
    btn.disabled = false; lbl.textContent = 'Snip it â†’';
  }
}

function showResult(data) {
  const card = document.getElementById('result-card');
  document.getElementById('result-url').href = data.short_url;
  document.getElementById('result-url').textContent = data.short_url;
  document.getElementById('result-original').textContent = data.long_url;
  document.getElementById('result-qr-img').src = data.qr_url + '?t=' + Date.now();
  card.classList.add('visible');
  document.getElementById('copy-btn').onclick = () => { navigator.clipboard.writeText(data.short_url); toast('Copied!'); };
  document.getElementById('dl-qr-btn').onclick = () => { const a = document.createElement('a'); a.href = data.qr_url; a.download = `qr-${data.code}.png`; a.click(); };
  document.getElementById('customize-qr-btn').onclick = () => { document.getElementById('qr-url-input').value = data.short_url; document.querySelector('[data-view="qr"]').click(); };
}

// â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  await Promise.all([loadStats(), loadTags()]);
  await loadLinks();
}

async function loadStats() {
  try {
    const d = await (await fetch(`${BASE}/api/stats`)).json();
    document.getElementById('stat-total').textContent  = d.total_links.toLocaleString();
    document.getElementById('stat-clicks').textContent = d.total_clicks.toLocaleString();
    document.getElementById('stat-7d').textContent     = d.clicks_7d.toLocaleString();
    const avg = d.total_links > 0 ? (d.total_clicks / d.total_links).toFixed(1) : '0';
    document.getElementById('stat-avg').textContent = avg;
  } catch(e) {}
}

async function loadTags() {
  try {
    const d = await (await fetch(`${BASE}/api/tags`)).json();
    allTags = d.tags;
    renderTagFilters();
  } catch(e) {}
}

function renderTagFilters() {
  const container = document.getElementById('tag-filter-list');
  container.innerHTML = '';
  if (!allTags.length) return;
  allTags.forEach(t => {
    const btn = document.createElement('button');
    btn.className = 'tag-filter-btn' + (activeTag === t.name ? ' active' : '');
    btn.textContent = `${t.name} (${t.link_count})`;
    btn.onclick = () => {
      activeTag = activeTag === t.name ? null : t.name;
      renderTagFilters();
      loadLinks();
    };
    container.appendChild(btn);
  });
}

async function loadLinks() {
  const q   = document.getElementById('search-input').value.trim();
  const tag = activeTag || '';
  let url   = `${BASE}/api/links?per_page=50`;
  if (q)   url += `&q=${encodeURIComponent(q)}`;
  if (tag) url += `&tag=${encodeURIComponent(tag)}`;

  try {
    const d = await (await fetch(url)).json();
    renderLinks(d.links);
  } catch(e) {
    document.getElementById('links-list').innerHTML = '<div class="empty-state"><div class="empty-icon">âš ï¸</div><p>Could not load links</p></div>';
  }
}

document.getElementById('search-input').addEventListener('input', () => {
  clearTimeout(searchTimer);
  searchTimer = setTimeout(loadLinks, 300);
});

function renderLinks(links) {
  const container = document.getElementById('links-list');
  if (!links.length) {
    container.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ”—</div><p>No links found</p></div>';
    return;
  }
  container.innerHTML = '';
  links.forEach(l => container.appendChild(buildLinkItem(l)));
}

function buildLinkItem(l) {
  const item = document.createElement('div');
  item.className = 'link-item';
  item.id = `item-${l.code}`;

  const tagPills = (l.tags || []).map(t => `<span class="link-tag">${t.name}</span>`).join('');
  const expiryNote = l.expires_at ? `<span style="font-size:10px;color:var(--muted);font-family:var(--font-mono)"> Â· exp ${l.expires_at.slice(0,10)}</span>` : '';

  item.innerHTML = `
    <div class="link-row" onclick="toggleExpand('${l.code}')">
      <div class="link-code">${l.code}</div>
      <div class="link-details">
        <div class="link-title">${l.title || l.long_url}</div>
        <div class="link-original">${l.long_url}</div>
        ${tagPills ? `<div class="link-tags">${tagPills}</div>` : ''}
      </div>
      <div class="link-meta">
        <div class="link-clicks"><strong>${l.clicks}</strong> clicks${expiryNote}</div>
        <svg class="link-chevron" width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M2 5L7 10L12 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
    </div>
    <div class="link-expanded" id="exp-${l.code}">
      <div class="expanded-actions">
        <button class="btn-sm" onclick="copyToClipboard('${l.short_url}')">Copy link</button>
        <button class="btn-sm" onclick="toggleEdit('${l.code}')">âœ Edit</button>
        <button class="btn-sm" onclick="window.open('${l.qr_url}')">â†“ QR</button>
        <button class="btn-sm danger" onclick="deleteLink('${l.code}')">âœ• Delete</button>
      </div>

      <div class="edit-form" id="edit-${l.code}">
        <h4>EDIT LINK</h4>
        <div class="edit-grid">
          <div class="edit-full">
            <label class="field-label">DESTINATION URL</label>
            <input class="field-input" id="edit-url-${l.code}" value="${escHtml(l.long_url)}">
          </div>
          <div>
            <label class="field-label">TITLE</label>
            <input class="field-input" id="edit-title-${l.code}" value="${escHtml(l.title || '')}">
          </div>
          <div>
            <label class="field-label">EXPIRY DATE</label>
            <input class="field-input" type="date" id="edit-expiry-${l.code}" value="${(l.expires_at || '').slice(0,10)}">
          </div>
          <div class="edit-full">
            <label class="field-label">TAGS (comma separated)</label>
            <input class="field-input" id="edit-tags-${l.code}" value="${(l.tags||[]).map(t=>t.name).join(', ')}">
          </div>
        </div>
        <div class="edit-actions">
          <button class="btn-sm" onclick="toggleEdit('${l.code}')">Cancel</button>
          <button class="btn-sm save" onclick="saveEdit('${l.code}')">Save changes</button>
        </div>
      </div>

      <div class="analytics-wrap" id="analytics-${l.code}">
        <div class="analytics-header">
          <div class="analytics-title">CLICK ANALYTICS</div>
          <div class="analytics-days">
            <button class="day-btn active" onclick="loadAnalytics('${l.code}', 7, this)">7d</button>
            <button class="day-btn" onclick="loadAnalytics('${l.code}', 30, this)">30d</button>
            <button class="day-btn" onclick="loadAnalytics('${l.code}', 90, this)">90d</button>
          </div>
        </div>
        <div id="analytics-content-${l.code}">
          <div style="color:var(--muted);font-size:12px;font-family:var(--font-mono)">Click to expand to load analytics</div>
        </div>
      </div>
    </div>
  `;
  return item;
}

function escHtml(s) {
  return String(s || '').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

async function toggleExpand(code) {
  const item = document.getElementById(`item-${code}`);
  const wasExpanded = item.classList.contains('expanded');
  item.classList.toggle('expanded');
  if (!wasExpanded) {
    await loadAnalytics(code, 7);
  }
}

function toggleEdit(code) {
  document.getElementById(`edit-${code}`).classList.toggle('open');
}

async function saveEdit(code) {
  const url    = document.getElementById(`edit-url-${code}`).value.trim();
  const title  = document.getElementById(`edit-title-${code}`).value.trim();
  const expiry = document.getElementById(`edit-expiry-${code}`).value;
  const tagsRaw = document.getElementById(`edit-tags-${code}`).value;
  const tags   = tagsRaw.split(',').map(t => t.trim()).filter(Boolean);

  try {
    const resp = await fetch(`${BASE}/api/links/${code}`, {
      method: 'PATCH', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url, title, expires_at: expiry || null, tags })
    });
    const data = await resp.json();
    if (!resp.ok) { toast(data.error || 'Save failed', 'error'); return; }
    toast('Link updated!');
    // Rebuild item in place
    const container = document.getElementById('links-list');
    const old = document.getElementById(`item-${code}`);
    const fresh = buildLinkItem(data);
    fresh.classList.add('expanded');
    container.replaceChild(fresh, old);
    loadStats(); loadTags();
  } catch(e) { toast('Network error', 'error'); }
}

async function deleteLink(code) {
  if (!confirm(`Delete /${code}? This cannot be undone.`)) return;
  await fetch(`${BASE}/api/links/${code}`, { method: 'DELETE' });
  document.getElementById(`item-${code}`)?.remove();
  toast('Link deleted');
  loadStats();
}

function copyToClipboard(url) {
  navigator.clipboard.writeText(url); toast('Copied!');
}

// â”€â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAnalytics(code, days, btnEl) {
  // Update day button state
  if (btnEl) {
    const btns = document.querySelectorAll(`#analytics-${code} .day-btn`);
    btns.forEach(b => b.classList.remove('active'));
    btnEl.classList.add('active');
  }

  const container = document.getElementById(`analytics-content-${code}`);
  container.innerHTML = '<div style="color:var(--muted);font-size:12px;font-family:var(--font-mono);padding:12px 0">Loading...</div>';

  try {
    const d = await (await fetch(`${BASE}/api/links/${code}/analytics?days=${days}`)).json();
    renderAnalytics(code, d);
  } catch(e) {
    container.innerHTML = '<div style="color:var(--muted);font-size:12px;font-family:var(--font-mono)">Could not load analytics</div>';
  }
}

function renderAnalytics(code, d) {
  const container = document.getElementById(`analytics-content-${code}`);
  const max = Math.max(...d.daily.map(x => x.clicks), 1);

  // Draw bar chart on canvas
  const chartId = `chart-${code}`;
  container.innerHTML = `
    <div class="chart-wrap">
      <canvas class="chart-canvas" id="${chartId}" height="100"></canvas>
    </div>
    <div class="breakdown-grid">
      <div class="breakdown-card" id="ref-${code}">
        <h5>REFERRERS</h5>
        ${renderBreakdown(d.referrers.map(r => ({label: r.source, count: r.count})))}
      </div>
      <div class="breakdown-card" id="dev-${code}">
        <h5>DEVICES</h5>
        ${renderBreakdown(d.devices.map(r => ({label: r.device, count: r.count})))}
      </div>
      <div class="breakdown-card" id="bro-${code}">
        <h5>BROWSERS</h5>
        ${renderBreakdown(d.browsers.map(r => ({label: r.browser, count: r.count})))}
      </div>
    </div>
  `;

  // Draw chart
  requestAnimationFrame(() => {
    const canvas = document.getElementById(chartId);
    if (!canvas) return;
    const ctx    = canvas.getContext('2d');
    const dpr    = window.devicePixelRatio || 1;
    const W      = canvas.offsetWidth;
    const H      = 100;
    canvas.width  = W * dpr;
    canvas.height = H * dpr;
    ctx.scale(dpr, dpr);

    const data   = d.daily;
    const n      = data.length;
    const barW   = Math.max(2, (W / n) - 2);
    const gap    = (W - barW * n) / (n - 1 || 1);

    ctx.clearRect(0, 0, W, H);

    data.forEach((point, i) => {
      const x      = i * (barW + gap);
      const barH   = max > 0 ? (point.clicks / max) * (H - 16) : 0;
      const y      = H - barH - 2;
      const alpha  = point.clicks > 0 ? 0.8 : 0.15;

      ctx.fillStyle = `rgba(0,229,160,${alpha})`;
      ctx.beginPath();
      ctx.roundRect(x, y, barW, barH + 2, [2, 2, 0, 0]);
      ctx.fill();
    });

    // X-axis labels (first, mid, last)
    ctx.fillStyle = 'rgba(107,107,128,0.8)';
    ctx.font      = `${10 * dpr / dpr}px "Share Tech Mono"`;
    ctx.textAlign = 'left';
    if (data.length > 0) {
      ctx.fillText(data[0].date.slice(5), 0, H);
      if (data.length > 2) {
        const mid = Math.floor(data.length / 2);
        ctx.textAlign = 'center';
        ctx.fillText(data[mid].date.slice(5), W / 2, H);
      }
      ctx.textAlign = 'right';
      ctx.fillText(data[data.length - 1].date.slice(5), W, H);
    }
  });
}

function renderBreakdown(rows) {
  if (!rows.length) return '<div style="color:var(--muted);font-size:12px;font-family:var(--font-mono)">No data</div>';
  const max = Math.max(...rows.map(r => r.count));
  return rows.map(r => `
    <div class="breakdown-row">
      <div class="breakdown-label">${escHtml(r.label)}</div>
      <div class="breakdown-bar-wrap">
        <div class="breakdown-bar" style="width:${Math.round((r.count/max)*100)}%"></div>
      </div>
      <div class="breakdown-count">${r.count}</div>
    </div>
  `).join('');
}

// â”€â”€ QR Generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const qrFgPicker = document.getElementById('qr-fg-picker');
const qrBgPicker = document.getElementById('qr-bg-picker');
const qrFgHex    = document.getElementById('qr-fg-hex');
const qrBgHex    = document.getElementById('qr-bg-hex');
const qrSize     = document.getElementById('qr-size');

qrFgPicker.addEventListener('input', () => qrFgHex.value = qrFgPicker.value.replace('#',''));
qrBgPicker.addEventListener('input', () => qrBgHex.value = qrBgPicker.value.replace('#',''));
qrFgHex.addEventListener('input',   () => { if(qrFgHex.value.length===6) qrFgPicker.value = '#'+qrFgHex.value; });
qrBgHex.addEventListener('input',   () => { if(qrBgHex.value.length===6) qrBgPicker.value = '#'+qrBgHex.value; });
qrSize.addEventListener('input',    () => document.getElementById('qr-size-label').textContent = qrSize.value + 'px');

document.getElementById('qr-generate-btn').addEventListener('click', () => {
  const url  = document.getElementById('qr-url-input').value.trim();
  if (!url) { toast('Please enter a URL', 'error'); return; }
  const fg   = qrFgHex.value.replace('#','') || '000000';
  const bg   = qrBgHex.value.replace('#','') || 'ffffff';
  const size = qrSize.value;
  const qrUrl = `${BASE}/api/qr/custom?url=${encodeURIComponent(url)}&fg=${fg}&bg=${bg}&size=${size}&t=${Date.now()}`;
  document.getElementById('qr-preview-wrap').innerHTML = `<div class="qr-preview-img"><img src="${qrUrl}" width="${Math.min(size,300)}" height="${Math.min(size,300)}" alt="QR Code"></div>`;
  const dlRow = document.getElementById('qr-dl-row');
  dlRow.style.display = 'flex';
  document.getElementById('qr-download-link').href = qrUrl;
  toast('QR code generated!');
});

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('error') === 'not_found') toast('Link not found', 'error');
if (urlParams.get('error') === 'expired')   toast('Link has expired', 'error');
</script>
</body>
</html>
